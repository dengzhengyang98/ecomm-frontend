<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>äº§å“ç”Ÿæˆ</title>
    <style>
        body { font-family: Arial; margin: 40px; max-width: 900px; }
        textarea { width: 100%; height: 150px; padding: 10px; font-size: 14px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .output-section { margin-top: 30px; }
        .output-box { 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            margin-bottom: 20px; 
            background: #f9f9f9;
        }
        .output-header { 
            background: #f0f0f0; 
            padding: 10px 15px; 
            font-weight: bold; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-bottom: 1px solid #ddd;
        }
        .output-content { 
            padding: 15px; 
            white-space: pre-wrap; 
            min-height: 60px;
            font-size: 14px;
            line-height: 1.6;
        }
        .copy-btn { 
            padding: 5px 12px; 
            font-size: 13px; 
            cursor: pointer; 
            background: #28a745; 
            color: white; 
            border: none; 
            border-radius: 3px;
        }
        .copy-btn:hover { background: #218838; }
        .copy-btn:active { background: #1e7e34; }
        .copied { background: #6c757d !important; }
    </style>
</head>
<body>
<h2>äº§å“ç”Ÿæˆ</h2>
<textarea id="inputBox" placeholder="è¾“å…¥äº§å“ä¿¡æ¯..."></textarea>
<br><br>
<button id="genBtn" onclick="generate()">Generate</button>

<div class="output-section">
    <div class="output-box">
        <div class="output-header">
            <span>äº§å“æ ‡é¢˜</span>
            <button class="copy-btn" onclick="copyToClipboard('title')">å¤åˆ¶</button>
        </div>
        <div class="output-content" id="title">ç­‰å¾…ç”Ÿæˆ...</div>
    </div>

    <div class="output-box">
        <div class="output-header">
            <span>äº§å“è¦ç‚¹</span>
            <button class="copy-btn" onclick="copyToClipboard('bulletPoint')">å¤åˆ¶</button>
        </div>
        <div class="output-content" id="bulletPoint">ç­‰å¾…ç”Ÿæˆ...</div>
    </div>

    <div class="output-box">
        <div class="output-header">
            <span>äº§å“æè¿°</span>
            <button class="copy-btn" onclick="copyToClipboard('description')">å¤åˆ¶</button>
        </div>
        <div class="output-content" id="description">ç­‰å¾…ç”Ÿæˆ...</div>
    </div>
</div>

<script>
let cooldown = false;

async function generate() {
    const btn = document.getElementById("genBtn");
    const inputText = document.getElementById("inputBox").value;

    if (!inputText.trim()) {
        alert("è¯·è¾“å…¥äº§å“ä¿¡æ¯ï¼");
        return;
    }

    if (cooldown) {
        alert("è¯·ç­‰å¾… 5 ç§’åå†ç”Ÿæˆï¼");
        return;
    }

    cooldown = true;
    btn.disabled = true;
    btn.innerText = "ç”Ÿæˆä¸­...";

    document.getElementById("title").innerText = "æ­£åœ¨ç”Ÿæˆ...";
    document.getElementById("bulletPoint").innerText = "æ­£åœ¨ç”Ÿæˆ...";
    document.getElementById("description").innerText = "æ­£åœ¨ç”Ÿæˆ...";

    try {
        const res = await fetch("https://u5ohkglvw7.execute-api.us-west-2.amazonaws.com/invoke", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ input_text: inputText })
        });

        const data = await res.json();

        console.log("Raw API Response:", data);

        // ğŸŒŸ FIX: data å°±æ˜¯æœ€ç»ˆæ•°æ®ï¼Œä¸åœ¨ data.body é‡Œé¢
        const bodyData = data;

        const structured = bodyData.result_structured;

        if (!structured) {
            document.getElementById("title").innerText = "è§£æå¤±è´¥";
            document.getElementById("bulletPoint").innerText = JSON.stringify(bodyData, null, 2);
            document.getElementById("description").innerText = "API æœªè¿”å›ç»“æ„åŒ–å­—æ®µ";
            return;
        }

        document.getElementById("title").innerText = structured.title || "æ— æ ‡é¢˜";
        document.getElementById("bulletPoint").innerText = (structured.bullet_point || "æ— è¦ç‚¹") + "\n" + (structured.title || "");
        document.getElementById("description").innerText = (structured.title || "") + "\n" + (structured.description || "æ— æè¿°");


    } catch (e) {
        document.getElementById("title").innerText = "è¯·æ±‚å¤±è´¥ï¼š" + e;
        document.getElementById("bulletPoint").innerText = "è¯·æ±‚å¤±è´¥";
        document.getElementById("description").innerText = "è¯·æ±‚å¤±è´¥";
        console.error("Error details:", e);
    }

    setTimeout(() => {
        cooldown = false;
        btn.disabled = false;
        btn.innerText = "Generate";
    }, 5000);
}


function copyToClipboard(elementId) {
    const content = document.getElementById(elementId).innerText;
    const btn = event.target;
    
    navigator.clipboard.writeText(content).then(() => {
        const originalText = btn.innerText;
        btn.innerText = "å·²å¤åˆ¶ï¼";
        btn.classList.add("copied");
        
        setTimeout(() => {
            btn.innerText = originalText;
            btn.classList.remove("copied");
        }, 2000);
    }).catch(err => {
        alert("å¤åˆ¶å¤±è´¥ï¼š" + err);
    });
}
</script>
</body>
</html>